/**
 * Flag box module for local_questionflags.
 *
 * Handles injecting the reason textarea and saving reasons via AJAX.
 *
 * @module local_questionflags/flagbox
 * @copyright 2024 Question Flags Development Team
 * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_questionflags/flagbox",["jquery"],(function($){function submitReason(questionId){var reasonBox=document.getElementById("flag-reason-"+questionId);if(reasonBox){var formData=new FormData;formData.append("save_reason","1"),formData.append("questionid",questionId),formData.append("reason",reasonBox.value),formData.append("sesskey",window.qfSesskey);var status=document.getElementById("reason-status-"+questionId);status&&(status.textContent="Saving..."),fetch(window.location.href,{method:"POST",body:formData}).then((function(response){return response.json()})).then((function(){status&&(status.textContent="Saved",setTimeout((function(){status.textContent=""}),2e3))})).catch((function(){status&&(status.textContent="Error")}))}}return{init:function(){window.submitReason=submitReason,document.querySelectorAll(".que").forEach((function(question){var flagContainer=question.querySelector(".question-flag-container");if(flagContainer){var questionId=null,idStr=question.id||"";if(-1!==idStr.indexOf("question-")){var parts=idStr.split("-"),slotNumber=parts[parts.length-1];window.questionMapping&&window.questionMapping[slotNumber]&&(questionId=window.questionMapping[slotNumber])}if(questionId&&!document.getElementById("flag-reason-"+questionId)){var currentFlag=window.questionFlagsData&&window.questionFlagsData[questionId]||"",reasonText=window.questionFlagReasons&&window.questionFlagReasons[questionId]||"",displayStyle="blue"===currentFlag||"red"===currentFlag?"block":"none",reasonDiv=document.createElement("div");reasonDiv.id="reason-container-"+questionId,reasonDiv.style.cssText="display:"+displayStyle+"; width:100%; margin-top:5px;";var textarea=document.createElement("textarea");textarea.id="flag-reason-"+questionId,textarea.className="form-control",textarea.placeholder="Why did you get this wrong?",textarea.style.cssText="width:100%; height:60px; font-size:12px; resize:vertical;",textarea.value=reasonText,textarea.onblur=function(){submitReason(questionId)};var statusDiv=document.createElement("div");statusDiv.id="reason-status-"+questionId,statusDiv.style.cssText="font-size:10px; color:#888; text-align:right; height:15px;",reasonDiv.appendChild(textarea),reasonDiv.appendChild(statusDiv),flagContainer.appendChild(reasonDiv)}}}))}}}));

//# sourceMappingURL=flagbox.min.js.map